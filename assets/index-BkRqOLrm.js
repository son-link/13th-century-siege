(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(n){if(n.ep)return;n.ep=!0;const o=t(n);fetch(n.href,o)}})();const le=""+new URL("map.png",import.meta.url).href,ae=""+new URL("tower.png",import.meta.url).href,pe=""+new URL("tower2.png",import.meta.url).href;class H{constructor(e={x:0,y:0,sprite:"",life:100,coins:10,speed:.4}){this.position={x:e.x,y:e.y},this.image=new Image,this.center={x:e.x+7,y:e.y+7},this.velocity={x:0,y:0},this.radius=9,this.image.src=e.sprite,this.wpIndex=0,this.life=e.life,this.lifeOri=e.life,this.coins=e.coins,this.speed=e.speed}draw(){ctx.fillStyle="#e6482e",ctx.fillRect(this.position.x,this.position.y+18,16,6),ctx.fillStyle="#38d973",ctx.fillRect(this.position.x+1,this.position.y+19,14*this.percentLife/100,4),ctx.drawImage(this.image,this.position.x,this.position.y,16,16)}update(){this.draw();const e=waypoints[this.wpIndex],t=e.x-this.center.x,s=e.y-this.center.y,n=Math.atan2(s,t),o=this.position.x+16>=0?this.speed*speedMulti:.4*speedMulti;this.velocity.x=Math.cos(n)*o,this.velocity.y=Math.sin(n)*o,this.position.x+=this.velocity.x,this.position.y+=this.velocity.y,this.center.x=this.position.x+8,this.center.y=this.position.y+8,Math.abs(this.center.x-e.x)<Math.abs(this.velocity.x)&&Math.abs(this.center.y-e.y)<Math.abs(this.velocity.y)&&this.wpIndex<waypoints.length-1&&this.wpIndex++,this.percentLife=100*this.life/this.lifeOri}}const he=""+new URL("ene1.png",import.meta.url).href;class ye extends H{constructor(e,t){const s={x:e,y:t,sprite:he,life:80,coins:10,speed:.4};super(s),this.options=s}}const de=""+new URL("ene2.png",import.meta.url).href;class fe extends H{constructor(e,t){const s={x:e,y:t,sprite:de,life:160,coins:10,speed:.35};super(s),this.options=s}}const ue=""+new URL("ene3.png",import.meta.url).href;class xe extends H{constructor(e,t){const s={x:e,y:t,sprite:ue,life:70,coins:10,speed:.6};super(s),this.options=s}}const h=[{x:0,y:208},{x:240,y:208},{x:240,y:112},{x:80,y:112},{x:80,y:48},{x:368,y:48},{x:368,y:272},{x:208,y:272},{x:208,y:336},{x:496,y:336},{x:496,y:144},{x:640,y:144}];class me{constructor(e={position:{x:0,y:0},target:{}}){this.position=e.position,this.target=e.target,this.velocity={x:0,y:0},this.radius=2}draw(){ctx.fillStyle="white",ctx.beginPath(),ctx.arc(this.position.x,this.position.y,this.radius,0,Math.PI*2),ctx.fill()}update(){this.draw();const e=this.target.center.x-this.position.x,t=this.target.center.y-this.position.y,s=Math.atan2(t,e);this.velocity.x=Math.cos(s)*speedMulti,this.velocity.y=Math.sin(s)*speedMulti,this.position.x+=this.velocity.x,this.position.y+=this.velocity.y}}let W,Z,P;Z=.3;W=(i=1,e=.05,t=220,s=0,n=0,o=.1,a=0,O=1,k=0,q=0,U=0,G=0,v=0,se=0,V=0,ie=0,y=0,A=1,M=0,J=0,l=Math,r=44100,p=2*l.PI,ne=k*=500*p/r/r,Q=t*=(1-e+2*e*l.random(e=[]))*p/r,x=0,oe=0,c=0,S=1,ce=0,re=0,f=0,X,m)=>{for(s=r*s+9,M*=r,n*=r,o*=r,y*=r,q*=500*p/r**3,V*=p/r,U*=p/r,G*=r,v=r*v|0,m=s+M+n+o+y|0;c<m;e[c++]=f)++re%(100*ie|0)||(f=a?1<a?2<a?3<a?l.sin((x%p)**3):l.max(l.min(l.tan(x),1),-1):1-(2*x/p%2+2)%2:1-4*l.abs(l.round(x/p)-x/p):l.sin(x),f=(v?1-J+J*l.sin(p*c/v):1)*(0<f?1:-1)*l.abs(f)**O*Z*i*(c<s?c/s:c<s+M?1-(c-s)/M*(1-A):c<s+M+n?A:c<m-y?(m-c-y)/o*A:0),f=y?f/2+(y>c?0:(c<m-y?1:(m-c)/y)*e[c-y|0]/2):f),X=(t+=k+=q)*l.cos(V*oe++),x+=X-X*se*(1-1e9*(l.sin(c)+1)%2),S&&++S>G&&(t+=U,Q+=U,S=0),!v||++ce%v||(t=Q,k=ne,S||=1);return i=P.createBuffer(1,m,r),i.getChannelData(0).set(e),t=P.createBufferSource(),t.buffer=i,t.connect(P.destination),t.start(),t};P=new AudioContext;const we=()=>W(2.88,void 0,442,void 0,.02,.08,2,1.59,6.4,.4,void 0,void 0,void 0,void 0,void 0,.3,.27,.69,.01),ge=()=>W(1.01,void 0,285,void 0,.06,.08,4,2.91,void 0,void 0,void 0,void 0,void 0,1.5,void 0,.3,void 0,.95,.01);class ve{constructor(e,t,s,n,o=1){this.position={x:e,y:t},this.image=new Image,this.image.src=s,this.center={x:e+16,y:t+16},this.radius=n,this.frames=0,this.targets=[],this.proyectiles=[],this.type=o}draw(){ctx.drawImage(this.image,this.position.x,this.position.y,32,32),this.proyectiles.forEach(e=>e.update())}update(){if(this.frames%Math.floor(60/speedMulti)==0)for(let e=0;e<enemies.length;e++){const t=enemies[e];let s=t.position.x-this.position.x,n=t.position.y-this.position.y;if(Math.hypot(n,s)<t.radius+this.radius){this.proyectiles.push(new me({position:{x:this.center.x,y:this.center.y},target:t})),we();break}}this.frames++,this.draw()}}const $e=[[0,0,343,0,343,0,343,0,0,343,0,343,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,343,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,343,0,343,0,0,0,0,0,343,0,0,0],[0,0,343,0,0,0,343,0,0,0,0,0,343,0,0,0,0,0,0,0],[0,0,343,0,0,343,0,0,343,0,0,0,0,0,343,0,343,0,0,0],[0,0,0,0,0,0,0,0,0,0,343,0,343,0,0,0,0,0,0,0],[0,0,343,0,0,343,0,343,0,0,0,0,0,0,343,0,343,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,343,0,343,0,0,0,343,0,0,343,0,343,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,343,0,0,0,343,0,0,0,343,0,0,0,0]];window.$=i=>document.querySelector(i);window.waypoints=h;window.scale=1;window.enemies=[];window.speedMulti=1;let b=300,D=5,w=!0,F=!0,g=1,j=[],u=[],L=!1,I=26;const B=26;let N=0;window.scale=1;let z=!0;const Y=h[0],d=$("#start_wave");d.style.left=`${Y.x+N}px`;d.style.top=`${Y.y+B-16}px`;const E=$("#tower_select");let C={},T=1;const _=$("#canvas");_.width=640;_.height=384;window.ctx=_.getContext("2d");ctx.imageSmoothingEnabled=!1;const K=new Image;K.onload=()=>{te(),R()};K.src=le;const R=()=>{if(z&&(ctx.save(),ctx.scale(scale,scale)),ctx.drawImage(K,0,0,640,384),T==2){if(j.forEach(i=>{i.update();for(let e=i.proyectiles.length-1;e>=0;e--){const t=i.proyectiles[e],s=t.target,n=s.center.x-t.position.x,o=s.center.y-t.position.y;Math.hypot(n,o)<s.radius+t.radius&&(t.target.life-=i.type==1?20:30,i.proyectiles.splice(e,1),ge()),Math.hypot(t.position.x-i.center.x,t.position.y-i.center.y)>=i.radius+6&&i.proyectiles.splice(e,1)}}),L){enemies.forEach(e=>e.update());const i=h[h.length-1];for(let e=enemies.length-1;e>=0;e--)enemies[e].life<=0?(b+=enemies[e].coins,enemies.splice(e,1),w=!0,F++):Math.round(enemies[e].center.x)>=i.x&&Math.round(enemies[e].center.y)>=i.y&&(enemies.splice(e,1),D-=1,w=!0,D==0&&(T=3,$("#screens").style.display="block",$("#game_over").style.display="block",$("#killed > span").innerText=F))}else d.style.display="block";enemies.length==0&&L&&(g++,L=!1)}if(w){$("#coins").innerText=b,$("#lifes").innerHTML="";for(let i=1;i<=5;i++){const e=i<=D?"heart":"heart_empty";$("#lifes").innerHTML+=`<span class="${e}" /></span>`}$("#wave").innerText=`Wave: ${g}`,$("#vel").innerText=`X${speedMulti}`,w=!1}z&&(ctx.restore(),z=!1),requestAnimationFrame(R)},ee=()=>{enemies=[];const i=[];for(let t=1;t<=g&&t<20;t++)[...Array(5)].forEach(()=>{t>=3&&t%3==0||t>=10&&t%2==0?i.push(2):t>=5&&t%5==0||t>=12&&t%3==0?i.push(3):i.push(1)});let e=I;i.forEach((t,s)=>{e+=g>=4&&g<=20?Math.floor(I-g/2):I,s>0&&s%5==0&&(e+=I),t==1?enemies.push(new ye(h[0].x-e,h[0].y-8)):t==2?enemies.push(new fe(h[0].x-e,h[0].y-8)):enemies.push(new xe(h[0].x-e,h[0].y-8))})},Ee=()=>{enemies=[],j=[],b=300,F=0,D=5,g=1,L=!1,w=!0,speedMulti=1},te=()=>{const i=window.getComputedStyle($("#game")),e=window.innerHeight;scale=i.height.replace("px","")/412,scale=parseFloat(scale.toFixed(2)),$("#game").style.width=e<420?`${640*scale}px`:"100%",z=!0,N=_.getBoundingClientRect().left;const s=u;u=[],$e.forEach((n,o)=>{n.forEach((a,O)=>{a==343&&u.push({x:Math.floor(O*(32*scale)),y:Math.floor(o*(32*scale))})})}),s&&u.forEach((n,o)=>{s[o]&&s[o].isOccupied&&(u[o].isOccupied=!0)}),d.style.left="0",d.style.top=`${Math.floor((Y.y+B-16)*scale)}px`,d.style.width=`${32*scale}px`,d.style.height=`${32*scale}px`};_.addEventListener("click",i=>{i.stopPropagation();const e=Math.round(i.clientX)-N,t=Math.round(i.clientY)-B;for(let s=0;s<u.length;s++){const n=u[s];if(e>=n.x&&e<=n.x+32&&t>=n.y&&t<=n.y+32&&!n.isOccupied){E.style.top=`${n.y+16}px`,E.style.left=`${n.x-16}px`,E.style.display="flex",C={x:n.x/scale,y:n.y/scale,index:s};break}else E.style.display="none"}});$("#start_game").addEventListener("click",()=>{Ee(),T=2,ee(),$("#screens").style.display="none",$("#start_screen").style.display="none"});$("#goto_start").addEventListener("click",()=>{T=1,$("#game_over").style.display="none",$("#start_screen").style.display="block"});document.querySelectorAll(".tower_btn").forEach(i=>{i.addEventListener("click",function(e){if(e.detail>1)return;const t=this.getAttribute("data-tower"),s=t==1?100:150,n=t==1?ae:pe;b-s>=0&&(j.push(new ve(C.x,C.y,n,46,t)),u[C.index].isOccupied=!0,b-=s,w=!0),E.style.display="none"})});d.addEventListener("click",()=>{ee(),L=!0,d.style.display="none"});window.addEventListener("click",i=>{E.style.display="none"});const Me=new ResizeObserver(()=>te());Me.observe($("#game"));$("#vel").addEventListener("click",()=>{speedMulti<3?speedMulti++:speedMulti=1,w=!0});$("#show_howto").addEventListener("click",()=>$("#howto").style.display="flex");$("#close_howto").addEventListener("click",()=>$("#howto").style.display="none");
