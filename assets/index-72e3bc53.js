(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const h of o.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();const L=""+new URL("map.png",import.meta.url).href,I=""+new URL("tower.png",import.meta.url).href;class w{constructor(e={x:0,y:0,sprite:"",life:100,coins:10,speed:.4}){this.position={x:e.x,y:e.y},this.image=new Image,this.center={x:e.x+7,y:e.y+7},this.velocity={x:0,y:0},this.radius=9,this.image.src=e.sprite,this.wpIndex=0,this.life=e.life,this.lifeOri=e.life,this.coins=e.coins,this.speed=e.speed}draw(){debug&&(ctx.beginPath(),ctx.fillStyle="rgba(255,0,0,.5)",ctx.arc(this.center.x,this.center.y,this.radius,0,Math.PI*2),ctx.fill()),ctx.fillStyle="#e6482e",ctx.fillRect(this.position.x,this.position.y+18,16,6),ctx.fillStyle="#38d973",ctx.fillRect(this.position.x+1,this.position.y+19,14*this.percentLife/100,4),ctx.drawImage(this.image,this.position.x,this.position.y,16,16)}update(){this.draw();const e=waypoints[this.wpIndex],t=e.x-this.center.x,s=e.y-this.center.y,i=Math.atan2(s,t),o=this.position.x+16>=0?this.speed:.4;this.velocity.x=Math.cos(i)*o,this.velocity.y=Math.sin(i)*o,this.position.x+=this.velocity.x,this.position.y+=this.velocity.y,this.center.x=this.position.x+8,this.center.y=this.position.y+8,Math.abs(Math.round(this.center.x)-Math.round(e.x))<Math.abs(this.velocity.x)&&Math.abs(Math.round(this.center.y)-Math.round(e.y))<Math.abs(this.velocity.y)&&this.wpIndex<waypoints.length-1&&this.wpIndex++,this.percentLife=100*this.life/this.lifeOri}}const P=""+new URL("ene1.png",import.meta.url).href;class O extends w{constructor(e,t){const s={x:e,y:t,sprite:P,life:80,coins:15,speed:.4};super(s),this.options=s}}const S=""+new URL("ene2.png",import.meta.url).href;class _ extends w{constructor(e,t){const s={x:e,y:t,sprite:S,life:160,coins:17,speed:.35};super(s),this.options=s}}const D=""+new URL("ene3.png",import.meta.url).href;class T extends w{constructor(e,t){const s={x:e,y:t,sprite:D,life:70,coins:20,speed:.8};super(s),this.options=s}}const r=[{x:0,y:208},{x:240,y:208},{x:240,y:112},{x:80,y:112},{x:80,y:48},{x:368,y:48},{x:368,y:272},{x:208,y:272},{x:208,y:336},{x:496,y:336},{x:496,y:144},{x:640,y:144}];class R{constructor(e={position:{x:0,y:0},target:{}}){this.position=e.position,this.target=e.target,this.velocity={x:0,y:0},this.radius=2}draw(){ctx.fillStyle="white",ctx.beginPath(),ctx.arc(this.position.x,this.position.y,this.radius,0,Math.PI*2),ctx.fill()}update(){this.draw();const e=this.target.center.x-this.position.x,t=this.target.center.y-this.position.y,s=Math.atan2(t,e);this.velocity.x=Math.cos(s),this.velocity.y=Math.sin(s),this.position.x+=this.velocity.x,this.position.y+=this.velocity.y}}class U{constructor(e,t,s,i){this.position={x:e,y:t},this.image=new Image,this.image.src=s,this.center={x:e+16,y:t+16},this.radius=i,this.frames=0,this.targets=[],this.proyectiles=[]}draw(){debug&&(ctx.beginPath(),ctx.fillStyle="rgba(0,255,0,.5)",ctx.arc(this.center.x,this.center.y,this.radius,0,Math.PI*2),ctx.fill()),ctx.drawImage(this.image,this.position.x,this.position.y,32,32),this.proyectiles.forEach(e=>e.update())}update(){if(this.frames%60==0)for(let e=0;e<enemies.length;e++){const t=enemies[e];let s=t.position.x-this.position.x,i=t.position.y-this.position.y;if(Math.hypot(i,s)<t.radius+this.radius){this.proyectiles.push(new R({position:{x:this.center.x,y:this.center.y},target:t}));break}}this.frames++,this.draw()}}const W=[[0,0,343,0,343,0,343,0,0,343,0,343,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,343,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,343,0,343,0,0,0,0,0,343,0,0,0],[0,0,343,0,0,0,343,0,0,0,0,0,343,0,0,0,0,0,0,0],[0,0,343,0,0,343,0,0,343,0,0,0,0,0,343,0,343,0,0,0],[0,0,0,0,0,0,0,0,0,0,343,0,343,0,0,0,0,0,0,0],[0,0,343,0,0,343,0,343,0,0,0,0,0,0,343,0,343,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,343,0,343,0,0,0,343,0,0,343,0,343,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,343,0,0,0,343,0,0,0,343,0,0,0,0]];window.$=n=>document.querySelector(n);window.waypoints=r;window.scale=1;window.enemies=[];window.dt=0;window.debug=!1;let p=200,d=5,a=!0,g=!0,c=1,u=0,v=[],f=[],l=!1,k=28;const q=26;let x=1;const m=$("#canvas");m.width=640;m.height=384;window.ctx=m.getContext("2d");ctx.imageSmoothingEnabled=!1;W.forEach((n,e)=>{n.forEach((t,s)=>{t==343&&f.push({x:s*32,y:e*32,isOccupied:!1})})});const M=new Image;M.onload=()=>{b()};M.src=L;const b=n=>{if(window.dt=n,ctx.drawImage(M,0,0,640,384),x==2){if(v.forEach(e=>{e.update();for(let t=e.proyectiles.length-1;t>=0;t--){const s=e.proyectiles[t],i=s.target,o=i.center.x-s.position.x,h=i.center.y-s.position.y;Math.hypot(o,h)<i.radius+s.radius&&(s.target.life-=20,e.proyectiles.splice(t,1))}}),l){enemies.forEach(t=>t.update());const e=r[r.length-1];for(let t=enemies.length-1;t>=0;t--)enemies[t].life<=0?(p+=enemies[t].coins,enemies.splice(t,1),a=!0,g++):Math.round(enemies[t].center.x)>=e.x&&Math.round(enemies[t].center.y)>=e.y&&(enemies.splice(t,1),d-=1,a=!0,d==0&&(x=3,$("#screens").style.display="block",$("#game_over").style.display="block",$("#killed > span").innerText=g))}enemies.length==0&&l&&(c++,l=!1,setTimeout(()=>{E(3),l=!0},5e3))}if(a){$("#coins").innerText=p,$("#lifes").innerHTML="";for(let e=1;e<=5;e++){const t=e<=d?"heart":"heart_empty";$("#lifes").innerHTML+=`<span class="${t}" /></span>`}$("#wave").innerText=`Wave: ${c}`,a=!1}requestAnimationFrame(b)},y=n=>Math.floor(u*n/100),E=n=>{u+=n,enemies=[];const e=[];for(let s=0;s<u;s++)c>=4&&c<7?s>=y(75)?e.push(2):e.push(1):c>=7?s>=y(50)&&s<y(75)?e.push(2):s>=y(75)?e.push(3):e.push(1):e.push(1);console.log(e);let t=k;e.forEach((s,i)=>{t+=c==1||c>5?24:28,s==1?enemies.push(new O(r[0].x-t,r[0].y-8)):s==2?enemies.push(new _(r[0].x-t,r[0].y-8)):enemies.push(new T(r[0].x-t,r[0].y-8))})},N=()=>{enemies=[],v=[],p=200,g=0,d=5,c=1,u=0,l=!1,a=!0};m.addEventListener("click",n=>{const e=Math.round(n.clientX),t=Math.round(n.clientY)-q;for(let s=0;s<f.length;s++){const i=f[s];if(e>=i.x&&e<=i.x+32&&t>=i.y&&t<=i.y+32&&!i.isOccupied&&p-100>=0){v.push(new U(i.x,i.y,I,49)),f[s].isOccupied=!0,p-=100,a=!0;break}}});$("#start_game").addEventListener("click",()=>{N(),x=2,E(3),setTimeout(()=>l=!0,5e3),$("#screens").style.display="none",$("#start_screen").style.display="none"});$("#goto_start").addEventListener("click",()=>{x=1,$("#game_over").style.display="none",$("#start_screen").style.display="block"});
