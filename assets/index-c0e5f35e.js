(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))t(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const p of o.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&t(p)}).observe(document,{childList:!0,subtree:!0});function i(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function t(s){if(s.ep)return;s.ep=!0;const o=i(s);fetch(s.href,o)}})();const E=""+new URL("map.png",import.meta.url).href,L=""+new URL("tower.png",import.meta.url).href;class g{constructor(e={x:0,y:0,sprite:"",life:100,coins:10,speed:.4}){this.position={x:e.x,y:e.y},this.image=new Image,this.center={x:e.x+7,y:e.y+7},this.velocity={x:0,y:0},this.radius=9,this.image.src=e.sprite,this.wpIndex=0,this.life=e.life,this.lifeOri=e.life,this.coins=e.coins,this.speed=e.speed}draw(){debug&&(ctx.beginPath(),ctx.fillStyle="rgba(255,0,0,.5)",ctx.arc(this.center.x,this.center.y,this.radius,0,Math.PI*2),ctx.fill()),ctx.fillStyle="#e6482e",ctx.fillRect(this.position.x,this.position.y+18,16,6),ctx.fillStyle="#38d973",ctx.fillRect(this.position.x+1,this.position.y+19,14*this.percentLife/100,4),ctx.drawImage(this.image,this.position.x,this.position.y,16,16)}update(){this.draw();const e=waypoints[this.wpIndex],i=e.x-this.center.x,t=e.y-this.center.y,s=Math.atan2(t,i),o=this.position.x+16>=0?this.speed:.4;this.velocity.x=Math.cos(s)*o,this.velocity.y=Math.sin(s)*o,this.position.x+=this.velocity.x,this.position.y+=this.velocity.y,this.center.x=this.position.x+8,this.center.y=this.position.y+8,Math.abs(Math.round(this.center.x)-Math.round(e.x))<Math.abs(this.velocity.x)&&Math.abs(Math.round(this.center.y)-Math.round(e.y))<Math.abs(this.velocity.y)&&this.wpIndex<waypoints.length-1&&this.wpIndex++,this.percentLife=100*this.life/this.lifeOri}}const I=""+new URL("ene1.png",import.meta.url).href;class O extends g{constructor(e,i){const t={x:e,y:i,sprite:I,life:80,coins:10,speed:.4};super(t),this.options=t}}const P=""+new URL("ene2.png",import.meta.url).href;class S extends g{constructor(e,i){const t={x:e,y:i,sprite:P,life:140,coins:10,speed:.35};super(t),this.options=t}}const _=""+new URL("ene3.png",import.meta.url).href;class D extends g{constructor(e,i){const t={x:e,y:i,sprite:_,life:70,coins:10,speed:.8};super(t),this.options=t}}const c=[{x:0,y:208},{x:240,y:208},{x:240,y:112},{x:80,y:112},{x:80,y:48},{x:368,y:48},{x:368,y:272},{x:208,y:272},{x:208,y:336},{x:496,y:336},{x:496,y:144},{x:640,y:144}];class T{constructor(e={position:{x:0,y:0},target:{}}){this.position=e.position,this.target=e.target,this.velocity={x:0,y:0},this.radius=2}draw(){ctx.fillStyle="white",ctx.beginPath(),ctx.arc(this.position.x,this.position.y,this.radius,0,Math.PI*2),ctx.fill()}update(){this.draw();const e=this.target.center.x-this.position.x,i=this.target.center.y-this.position.y,t=Math.atan2(i,e);this.velocity.x=Math.cos(t),this.velocity.y=Math.sin(t),this.position.x+=this.velocity.x,this.position.y+=this.velocity.y}}class R{constructor(e,i,t,s){this.position={x:e,y:i},this.image=new Image,this.image.src=t,this.center={x:e+16,y:i+16},this.radius=s,this.frames=0,this.targets=[],this.proyectiles=[]}draw(){debug&&(ctx.beginPath(),ctx.fillStyle="rgba(0,255,0,.5)",ctx.arc(this.center.x,this.center.y,this.radius,0,Math.PI*2),ctx.fill()),ctx.drawImage(this.image,this.position.x,this.position.y,32,32),this.proyectiles.forEach(e=>e.update())}update(){if(this.frames%60==0)for(let e=0;e<enemies.length;e++){const i=enemies[e];let t=i.position.x-this.position.x,s=i.position.y-this.position.y;if(Math.hypot(s,t)<i.radius+this.radius){this.proyectiles.push(new T({position:{x:this.center.x,y:this.center.y},target:i}));break}}this.frames++,this.draw()}}const U=[[0,0,343,0,343,0,343,0,0,343,0,343,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,343,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,343,0,343,0,0,0,0,0,343,0,0,0],[0,0,343,0,0,0,343,0,0,0,0,0,343,0,0,0,0,0,0,0],[0,0,343,0,0,343,0,0,343,0,0,0,0,0,343,0,343,0,0,0],[0,0,0,0,0,0,0,0,0,0,343,0,343,0,0,0,0,0,0,0],[0,0,343,0,0,343,0,343,0,0,0,0,0,0,343,0,343,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,343,0,343,0,0,0,343,0,0,343,0,343,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,343,0,0,0,343,0,0,0,343,0,0,0,0]];window.$=n=>document.querySelector(n);window.waypoints=c;window.scale=1;window.enemies=[];window.debug=!1;let h=300,d=5,a=!0,m=!0,r=1,w=[],f=[],l=!1,y=26;const k=26;let u=1;const x=$("#canvas");x.width=640;x.height=384;window.ctx=x.getContext("2d");ctx.imageSmoothingEnabled=!1;U.forEach((n,e)=>{n.forEach((i,t)=>{i==343&&f.push({x:t*32,y:e*32,isOccupied:!1})})});const v=new Image;v.onload=()=>{M()};v.src=E;const M=()=>{if(ctx.drawImage(v,0,0,640,384),u==2){if(w.forEach(n=>{n.update();for(let e=n.proyectiles.length-1;e>=0;e--){const i=n.proyectiles[e],t=i.target,s=t.center.x-i.position.x,o=t.center.y-i.position.y;Math.hypot(s,o)<t.radius+i.radius&&(i.target.life-=20,n.proyectiles.splice(e,1)),Math.hypot(i.position.x-n.center.x,i.position.y-n.center.y)>=n.radius+2&&n.proyectiles.splice(e,1)}}),l){enemies.forEach(e=>e.update());const n=c[c.length-1];for(let e=enemies.length-1;e>=0;e--)enemies[e].life<=0?(h+=enemies[e].coins,enemies.splice(e,1),a=!0,m++):Math.round(enemies[e].center.x)>=n.x&&Math.round(enemies[e].center.y)>=n.y&&(enemies.splice(e,1),d-=1,a=!0,d==0&&(u=3,$("#screens").style.display="block",$("#game_over").style.display="block",$("#killed > span").innerText=m))}enemies.length==0&&l&&(r++,l=!1,setTimeout(()=>{b(),l=!0},5e3))}if(a){$("#coins").innerText=h,$("#lifes").innerHTML="";for(let n=1;n<=5;n++){const e=n<=d?"heart":"heart_empty";$("#lifes").innerHTML+=`<span class="${e}" /></span>`}$("#wave").innerText=`Wave: ${r}`,a=!1}requestAnimationFrame(M)},b=n=>{enemies=[];const e=[];for(let t=1;t<=r;t++)[...Array(4)].forEach(()=>{t>=3&&t%3==0?e.push(2):t>=5&&t%5==0?enes.push(3):e.push(1)});let i=y;e.forEach((t,s)=>{i+=r>=3&&r%3==0?y-r/3:y,s>0&&s%4==0&&(i+=y),t==1?enemies.push(new O(c[0].x-i,c[0].y-8)):t==2?enemies.push(new S(c[0].x-i,c[0].y-8)):enemies.push(new D(c[0].x-i,c[0].y-8))})},W=()=>{enemies=[],w=[],h=300,m=0,d=5,r=1,l=!1,a=!0};x.addEventListener("click",n=>{const e=Math.round(n.clientX),i=Math.round(n.clientY)-k;for(let t=0;t<f.length;t++){const s=f[t];if(e>=s.x&&e<=s.x+32&&i>=s.y&&i<=s.y+32&&!s.isOccupied&&h-100>=0){w.push(new R(s.x,s.y,L,49)),f[t].isOccupied=!0,h-=100,a=!0;break}}});$("#start_game").addEventListener("click",()=>{W(),u=2,b(),setTimeout(()=>l=!0,5e3),$("#screens").style.display="none",$("#start_screen").style.display="none"});$("#goto_start").addEventListener("click",()=>{u=1,$("#game_over").style.display="none",$("#start_screen").style.display="block"});
