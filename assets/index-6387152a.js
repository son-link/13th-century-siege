(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const h of o.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&i(h)}).observe(document,{childList:!0,subtree:!0});function t(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(n){if(n.ep)return;n.ep=!0;const o=t(n);fetch(n.href,o)}})();const D=""+new URL("map.png",import.meta.url).href,T=""+new URL("tower.png",import.meta.url).href,C=""+new URL("tower2.png",import.meta.url).href;class E{constructor(e={x:0,y:0,sprite:"",life:100,coins:10,speed:.4}){this.position={x:e.x,y:e.y},this.image=new Image,this.center={x:e.x+7,y:e.y+7},this.velocity={x:0,y:0},this.radius=9,this.image.src=e.sprite,this.wpIndex=0,this.life=e.life,this.lifeOri=e.life,this.coins=e.coins,this.speed=e.speed}draw(){ctx.fillStyle="#e6482e",ctx.fillRect(this.position.x,this.position.y+18,16,6),ctx.fillStyle="#38d973",ctx.fillRect(this.position.x+1,this.position.y+19,14*this.percentLife/100,4),ctx.drawImage(this.image,this.position.x,this.position.y,16,16)}update(){this.draw();const e=waypoints[this.wpIndex],t=e.x-this.center.x,i=e.y-this.center.y,n=Math.atan2(i,t),o=this.position.x+16>=0?this.speed*speedMulti:.4*speedMulti;this.velocity.x=Math.cos(n)*o,this.velocity.y=Math.sin(n)*o,this.position.x+=this.velocity.x,this.position.y+=this.velocity.y,this.center.x=this.position.x+8,this.center.y=this.position.y+8,Math.abs(this.center.x-e.x)<Math.abs(this.velocity.x)&&Math.abs(this.center.y-e.y)<Math.abs(this.velocity.y)&&this.wpIndex<waypoints.length-1&&this.wpIndex++,this.percentLife=100*this.life/this.lifeOri}}const U=""+new URL("ene1.png",import.meta.url).href;class A extends E{constructor(e,t){const i={x:e,y:t,sprite:U,life:80,coins:10,speed:.4};super(i),this.options=i}}const q=""+new URL("ene2.png",import.meta.url).href;class F extends E{constructor(e,t){const i={x:e,y:t,sprite:q,life:160,coins:10,speed:.35};super(i),this.options=i}}const H=""+new URL("ene3.png",import.meta.url).href;class W extends E{constructor(e,t){const i={x:e,y:t,sprite:H,life:70,coins:10,speed:.6};super(i),this.options=i}}const c=[{x:0,y:208},{x:240,y:208},{x:240,y:112},{x:80,y:112},{x:80,y:48},{x:368,y:48},{x:368,y:272},{x:208,y:272},{x:208,y:336},{x:496,y:336},{x:496,y:144},{x:640,y:144}];class X{constructor(e={position:{x:0,y:0},target:{}}){this.position=e.position,this.target=e.target,this.velocity={x:0,y:0},this.radius=2}draw(){ctx.fillStyle="white",ctx.beginPath(),ctx.arc(this.position.x,this.position.y,this.radius,0,Math.PI*2),ctx.fill()}update(){this.draw();const e=this.target.center.x-this.position.x,t=this.target.center.y-this.position.y,i=Math.atan2(t,e);this.velocity.x=Math.cos(i)*speedMulti,this.velocity.y=Math.sin(i)*speedMulti,this.position.x+=this.velocity.x,this.position.y+=this.velocity.y}}class j{constructor(e,t,i,n,o=1){this.position={x:e,y:t},this.image=new Image,this.image.src=i,this.center={x:e+16,y:t+16},this.radius=n,this.frames=0,this.targets=[],this.proyectiles=[],this.type=o}draw(){ctx.drawImage(this.image,this.position.x,this.position.y,32,32),this.proyectiles.forEach(e=>e.update())}update(){if(this.frames%Math.floor(60/speedMulti)==0)for(let e=0;e<enemies.length;e++){const t=enemies[e];let i=t.position.x-this.position.x,n=t.position.y-this.position.y;if(Math.hypot(n,i)<t.radius+this.radius){this.proyectiles.push(new X({position:{x:this.center.x,y:this.center.y},target:t}));break}}this.frames++,this.draw()}}const N=[[0,0,343,0,343,0,343,0,0,343,0,343,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,343,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,343,0,343,0,0,0,0,0,343,0,0,0],[0,0,343,0,0,0,343,0,0,0,0,0,343,0,0,0,0,0,0,0],[0,0,343,0,0,343,0,0,343,0,0,0,0,0,343,0,343,0,0,0],[0,0,0,0,0,0,0,0,0,0,343,0,343,0,0,0,0,0,0,0],[0,0,343,0,0,343,0,343,0,0,0,0,0,0,343,0,343,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,343,0,343,0,0,0,343,0,0,343,0,343,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,343,0,0,0,343,0,0,0,343,0,0,0,0]];window.$=s=>document.querySelector(s);window.waypoints=c;window.scale=1;window.enemies=[];window.speedMulti=1;let f=300,m=5,a=!0,M=!0,p=1,L=[],r=[],d=!1,x=26;const b=26;let _=0;window.scale=1;let w=!0;const O=c[0],l=$("#start_wave");l.style.left=`${O.x+_}px`;l.style.top=`${O.y+b-16}px`;const y=$("#tower_select");let g={},v=1;const u=$("#canvas");u.width=640;u.height=384;window.ctx=u.getContext("2d");ctx.imageSmoothingEnabled=!1;const S=new Image;S.onload=()=>{R(),k()};S.src=D;const k=()=>{if(w&&(ctx.save(),ctx.scale(scale,scale)),ctx.drawImage(S,0,0,640,384),v==2){if(L.forEach(s=>{s.update();for(let e=s.proyectiles.length-1;e>=0;e--){const t=s.proyectiles[e],i=t.target,n=i.center.x-t.position.x,o=i.center.y-t.position.y;Math.hypot(n,o)<i.radius+t.radius&&(t.target.life-=s.type==1?20:30,s.proyectiles.splice(e,1)),Math.hypot(t.position.x-s.center.x,t.position.y-s.center.y)>=s.radius+6&&s.proyectiles.splice(e,1)}}),d){enemies.forEach(e=>e.update());const s=c[c.length-1];for(let e=enemies.length-1;e>=0;e--)enemies[e].life<=0?(f+=enemies[e].coins,enemies.splice(e,1),a=!0,M++):Math.round(enemies[e].center.x)>=s.x&&Math.round(enemies[e].center.y)>=s.y&&(enemies.splice(e,1),m-=1,a=!0,m==0&&(v=3,$("#screens").style.display="block",$("#game_over").style.display="block",$("#killed > span").innerText=M))}else l.style.display="block";enemies.length==0&&d&&(p++,d=!1)}if(a){$("#coins").innerText=f,$("#lifes").innerHTML="";for(let s=1;s<=5;s++){const e=s<=m?"heart":"heart_empty";$("#lifes").innerHTML+=`<span class="${e}" /></span>`}$("#wave").innerText=`Wave: ${p}`,$("#vel").innerText=`X${speedMulti}`,a=!1}w&&(ctx.restore(),w=!1),requestAnimationFrame(k)},P=()=>{enemies=[];const s=[];for(let t=1;t<=p&&t<20;t++)[...Array(5)].forEach(()=>{t>=3&&t%3==0||t>=10&&t%2==0?s.push(2):t>=5&&t%5==0||t>=12&&t%3==0?s.push(3):s.push(1)});let e=x;s.forEach((t,i)=>{e+=p>=4&&p<=20?Math.floor(x-p/2):x,i>0&&i%5==0&&(e+=x),t==1?enemies.push(new A(c[0].x-e,c[0].y-8)):t==2?enemies.push(new F(c[0].x-e,c[0].y-8)):enemies.push(new W(c[0].x-e,c[0].y-8))})},Y=()=>{enemies=[],L=[],f=300,M=0,m=5,p=1,d=!1,a=!0,speedMulti=1},R=()=>{const s=window.getComputedStyle($("#game")),e=window.innerHeight;scale=s.height.replace("px","")/412,scale=parseFloat(scale.toFixed(2)),$("#game").style.width=e<420?`${640*scale}px`:"100%",w=!0,_=u.getBoundingClientRect().left;const i=r;r=[],N.forEach((n,o)=>{n.forEach((h,I)=>{h==343&&r.push({x:Math.floor(I*(32*scale)),y:Math.floor(o*(32*scale))})})}),i&&r.forEach((n,o)=>{i[o]&&i[o].isOccupied&&(r[o].isOccupied=!0)}),l.style.left="0",l.style.top=`${Math.floor((O.y+b-16)*scale)}px`,l.style.width=`${32*scale}px`,l.style.height=`${32*scale}px`};u.addEventListener("click",s=>{s.stopPropagation();const e=Math.round(s.clientX)-_,t=Math.round(s.clientY)-b;for(let i=0;i<r.length;i++){const n=r[i];if(e>=n.x&&e<=n.x+32&&t>=n.y&&t<=n.y+32&&!n.isOccupied){y.style.top=`${n.y+16}px`,y.style.left=`${n.x-16}px`,y.style.display="flex",g={x:n.x/scale,y:n.y/scale,index:i};break}else y.style.display="none"}});$("#start_game").addEventListener("click",()=>{Y(),v=2,P(),$("#screens").style.display="none",$("#start_screen").style.display="none"});$("#goto_start").addEventListener("click",()=>{v=1,$("#game_over").style.display="none",$("#start_screen").style.display="block"});document.querySelectorAll(".tower_btn").forEach(s=>{s.addEventListener("click",function(e){if(e.detail>1)return;const t=this.getAttribute("data-tower"),i=t==1?100:150,n=t==1?T:C;f-i>=0&&(L.push(new j(g.x,g.y,n,46,t)),r[g.index].isOccupied=!0,f-=i,a=!0),y.style.display="none"})});l.addEventListener("click",()=>{P(),d=!0,l.style.display="none"});window.addEventListener("click",s=>{y.style.display="none"});const z=new ResizeObserver(()=>R());z.observe($("#game"));$("#vel").addEventListener("click",()=>{speedMulti<3?speedMulti++:speedMulti=1,a=!0});$("#show_howto").addEventListener("click",()=>$("#howto").style.display="flex");$("#close_howto").addEventListener("click",()=>$("#howto").style.display="none");
